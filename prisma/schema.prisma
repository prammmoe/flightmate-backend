// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())
  name String
  // password String 
  email String @unique
  role Role
  bookings Booking[]
  // staff Staff?

  createdAt DateTime @default(now())
  updateAt DateTime @updatedAt
}

model Passenger {
  id Int @id @default(autoincrement())
  firstName String
  lastName String
  dateOfBirth DateTime
  bookings Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Airport {
  id Int @id @default(autoincrement())
  name String 
  city String
  country String
  iataCode String @unique
  icaoCode String @unique
  departures Flight[] @relation("departures")
  arrivals Flight[] @relation("arrivals")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Aircraft {
  id Int @id @default(autoincrement())
  model String
  manufacturer String
  seatingCapacity Int
  flights Flight[]

  createdAt DateTime @default(now())
  updated DateTime @updatedAt
}

model Flight {
  id Int @id @default(autoincrement())
  flightNumber String @unique
  departureAirportId Int
  arrivalAirportId Int
  departureTime DateTime
  arrivalTime DateTime
  aircraftId Int
  status FlightStatus
  bookings Booking[]
  flightCrew FlightCrew[]

  departureAirport Airport @relation("departures", fields: [departureAirportId], references: [id])
  arrivalAirport Airport @relation("arrivals", fields: [arrivalAirportId], references: [id])
  aircraft Aircraft @relation(fields: [aircraftId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Booking {
  id Int @id @default(autoincrement())
  userId Int
  passengerId Int
  flightId Int
  bookingDate DateTime
  status BookingStatus
  seatNumber String
  payment Payment?

  user User @relation(fields: [userId], references: [id])
  passenger Passenger @relation(fields: [passengerId], references: [id])
  flight Flight @relation(fields: [flightId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id Int @id @default(autoincrement())
  bookingId Int @unique
  amount Float
  paymentDate DateTime
  paymentMethod PaymentMethod
  status PaymentStatus  

  booking Booking @relation(fields: [bookingId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Staff {
  id Int @id @default(autoincrement())
  userId Int @unique
  position String 
  department String
  flightCrew FlightCrew[]

  // user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FlightCrew {
  id Int @id @default(autoincrement())
  flightId Int
  staffId Int
  role CrewRole

  flight Flight @relation(fields: [flightId], references: [id])
  staff Staff @relation(fields: [staffId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  ADMIN
  CUSTOMER 
  STAFF
}

enum FlightStatus {
  SCHEDULED 
  ON_TIME
  DELAYED
  CANCELLED
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  PENDING
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
}

enum PaymentStatus {
  COMPLETED
  FAILED
  PENDING
}

enum CrewRole {
  PILOT
  CO_PILOT
  ATTENDANT
}